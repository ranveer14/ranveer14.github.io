<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
<div id="pomodoro-app"></div>
<div id="pomodoro-floating-timer" style="
  position: fixed;
  top: 10px;
  right: 10px;
  background: #0b1328;
  color: #fff;
  padding: 8px 12px;
  border-radius: 8px;
  font-family: sans-serif;
  font-size: 14px;
  z-index: 9999;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  cursor: pointer;
">
  <span id="floating-timer-label">Pomodoro:</span> 
  <span id="floating-timer-time">25:00</span>
</div>
<script>
(function() {
  const timerLabel = document.getElementById('floating-timer-label');
  const timerTime  = document.getElementById('floating-timer-time');

  const LS_KEY = 'pomodoro.v1';
  const DEFAULT_WORK = 25*60*1000;

  // Simple floating timer, checks localStorage from main Pomodoro tab
  function updateFloatingTimer() {
    const dataRaw = localStorage.getItem(LS_KEY);
    if (!dataRaw) {
      timerTime.textContent = '25:00';
      return;
    }
    const settings = JSON.parse(dataRaw);
    let mode = settings.mode || 'work';
    let mins = (mode === 'work') ? settings.work : (mode === 'short') ? settings.short : settings.long;
    let startAt = settings.startAt || 0;
    let remaining = mins*60*1000;

    if (settings.running && startAt) {
      const elapsed = Date.now() - startAt;
      remaining = Math.max(0, mins*60*1000 - elapsed);
    }

    const s = Math.ceil(remaining/1000);
    const mm = String(Math.floor(s/60)).padStart(2,'0');
    const ss = String(s%60).padStart(2,'0');
    timerTime.textContent = `${mm}:${ss}`;
  }

  updateFloatingTimer();
  setInterval(updateFloatingTimer, 1000);

  // Optional: click floating timer to go to Pomodoro page
  document.getElementById('pomodoro-floating-timer').addEventListener('click', () => {
    window.location.href = '/pomodoro/';
  });
})();
</script>

  <head>
    <!-- General meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% if page.indexing == false %}
      <meta name="robots" content="noindex">
    {% endif %}

    {% if page.collectionpage %}
      {% seo title=false %}

      {% assign collectiondata = site.collections | where: "label", page.collectionpage | first %}
      <title>{{ collectiondata.title }} - {{ site.title }}</title>
      <meta property="og:title" content="{{ collectiondata.title }}">
      <meta name="description" content="{{ collectiondata.description }}">
      <meta property="og:description" content="{{ collectiondata.description }}">
    {% else %}
      {% seo %}
    {% endif %}

    <link rel="manifest" href="{{ "/manifest.json" | relative_url }}">
    <meta name="theme-color" content="{{ site.manifest.theme_color | default: '#242e2b' }}"/>

    {% if site.css_inline == true %}
      {% include site-styles.html %}
    {% else %}
      <link rel="stylesheet" href="{{ "/assets/styles.css" | relative_url }}">
    {% endif %}

    {% if site.favicons or site.avatarurl %}{% include site-favicons.html %}{% endif %}

    {% if site.google_analytics %}{% include site-analytics.html %}{% endif %}

    {% include site-before-start.html %}
  </head>

  <body class="layout-{{ page.layout }}{% if page.title %}  {{ page.title | slugify }}{% endif %}">
    {% include site-icons.svg %}

    {{ content }}

    {% if site.service_worker != false %}{% include site-sw.html %}{% endif %}

    {% include site-before-end.html %}
  </body>

</html>
