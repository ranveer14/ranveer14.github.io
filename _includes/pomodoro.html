<div class="pomodoro-app">
  <h2>Pomodoro Timer</h2>
  <div id="timer">25:00</div>
  <button id="startBtn">Start</button>
  <button id="resetBtn">Reset</button>

  <h3>Session History</h3>
  <ul id="history"></ul>
</div>

<script>
(function() {
  let timerDisplay = document.getElementById("timer");
  let startBtn = document.getElementById("startBtn");
  let resetBtn = document.getElementById("resetBtn");
  let historyList = document.getElementById("history");

  let duration = 25 * 60; // default work duration = 25 minutes
  let timeLeft = duration;
  let timer = null;

  function updateDisplay() {
    let minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;
    timerDisplay.textContent = 
      String(minutes).padStart(2, "0") + ":" + String(seconds).padStart(2, "0");
  }

  function startTimer() {
    if (timer) return; // already running
    timer = setInterval(() => {
      timeLeft--;
      updateDisplay();
      if (timeLeft <= 0) {
        clearInterval(timer);
        timer = null;

        // Record session
        recordSession("Work session finished");

        // Auto-redirect to pomodoro page
        window.location.href = "/pomodoro/";

        // Reset timer for next session
        timeLeft = duration;
        updateDisplay();
      }
    }, 1000);
  }

  function resetTimer() {
    clearInterval(timer);
    timer = null;
    timeLeft = duration;
    updateDisplay();
  }

  // ---- Session history handling ----
  function recordSession(msg) {
    let history = JSON.parse(localStorage.getItem("pomodoroHistory") || "[]");
    history.unshift({
      message: msg,
      time: new Date().toLocaleString()
    });
    localStorage.setItem("pomodoroHistory", JSON.stringify(history));
    renderHistory();
  }

  function renderHistory() {
    historyList.innerHTML = "";
    let history = JSON.parse(localStorage.getItem("pomodoroHistory") || "[]");
    history.forEach(entry => {
      let li = document.createElement("li");
      li.textContent = `${entry.message} at ${entry.time}`;
      historyList.appendChild(li);
    });
  }

  // ---- Initialize ----
  updateDisplay();
  renderHistory();

  startBtn.addEventListener("click", startTimer);
  resetBtn.addEventListener("click", resetTimer);
})();
</script>

<style>
.pomodoro-app {
  font-family: sans-serif;
  text-align: center;
  margin-top: 20px;
}
#timer {
  font-size: 2em;
  margin: 10px 0;
}
button {
  margin: 5px;
  padding: 10px 20px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}
#history {
  text-align: left;
  max-width: 300px;
  margin: 10px auto;
}
</style>
