<div id="pomodoro-app" class="pomodoro">
  <h1>Pomodoro Timer</h1>
  <div id="timer-display">25:00</div>
  <div id="status-display">Work</div>
  <button id="start-btn">Start</button>
  <button id="reset-btn">Reset</button>

  <h2>Session History</h2>
  <ul id="history-list"></ul>
</div>

<style>
  .pomodoro {
    text-align: center;
    margin: 40px auto;
    max-width: 400px;
    padding: 20px;
    border: 2px solid #333;
    border-radius: 12px;
    background: #fdfdfd;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  #timer-display {
    font-size: 3em;
    margin: 20px 0;
  }
  #status-display {
    font-size: 1.5em;
    margin-bottom: 20px;
  }
  button {
    padding: 10px 20px;
    margin: 5px;
    font-size: 1em;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: #007acc;
    color: #fff;
  }
  button:hover {
    background: #005f99;
  }
  #history-list {
    text-align: left;
    max-height: 200px;
    overflow-y: auto;
    padding-left: 20px;
  }
</style>

<script>
  // Timer settings
  const workDuration = 25 * 60;
  const shortBreakDuration = 5 * 60;
  const longBreakDuration = 15 * 60;

  let timer;
  let timeLeft = workDuration;
  let isRunning = false;
  let cycleCount = 0;
  let status = "Work";

  const display = document.getElementById("timer-display");
  const statusDisplay = document.getElementById("status-display");
  const historyList = document.getElementById("history-list");

  // Load session history
  function loadHistory() {
    return JSON.parse(localStorage.getItem("pomodoroHistory") || "[]");
  }

  function saveHistory(history) {
    localStorage.setItem("pomodoroHistory", JSON.stringify(history));
  }

  function recordSession(sessionType) {
    const history = loadHistory();
    history.unshift(`${sessionType} session completed at ${new Date().toLocaleString()}`);
    saveHistory(history);
    renderHistory();
  }

  function renderHistory() {
    const history = loadHistory();
    historyList.innerHTML = "";
    history.forEach(item => {
      const li = document.createElement("li");
      li.textContent = item;
      historyList.appendChild(li);
    });
  }

  // Timer control
  function updateDisplay() {
    const minutes = String(Math.floor(timeLeft / 60)).padStart(2, "0");
    const seconds = String(timeLeft % 60).padStart(2, "0");
    display.textContent = `${minutes}:${seconds}`;
    statusDisplay.textContent = status;
  }

  function startTimer() {
    if (isRunning) return;
    isRunning = true;
    timer = setInterval(() => {
      timeLeft--;
      updateDisplay();

      if (timeLeft <= 0) {
        clearInterval(timer);
        isRunning = false;
        recordSession(status);

        // Auto redirect back to pomodoro page
        window.location.href = "/pomodoro/";

        // Advance cycle
        if (status === "Work") {
          cycleCount++;
          if (cycleCount % 4 === 0) {
            status = "Long Break";
            timeLeft = longBreakDuration;
          } else {
            status = "Short Break";
            timeLeft = shortBreakDuration;
          }
        } else {
          status = "Work";
          timeLeft = workDuration;
        }
        updateDisplay();
      }
    }, 1000);
  }

  function resetTimer() {
    clearInterval(timer);
    isRunning = false;
    status = "Work";
    timeLeft = workDuration;
    updateDisplay();
  }

  document.getElementById("start-btn").addEventListener("click", startTimer);
  document.getElementById("reset-btn").addEventListener("click", resetTimer);

  // Init
  updateDisplay();
  renderHistory();
</script>
